import { FloatingCapsuleManager } from '../utils/FloatingCapsuleManager';

@Entry
@Component
struct CapsulePage {
  @State isBusy: boolean = false;

  build() {
    Stack() {
      // èƒ¶å›Šä¸»ä½“
      Row() {
        // å·¦ä¾§å›¾æ ‡/çŠ¶æ€
        if (this.isBusy) {
          LoadingProgress()
            .width(18)
            .height(18)
            .color('#FFFFFF')
            .margin({ right: 6 })
        } else {
          // ç®€å•çš„â€œå›¾ç‰‡â€å›¾æ ‡ç¤ºæ„
          Text('ğŸ“·')
            .fontSize(16)
            .margin({ right: 6 })
        }

        // å³ä¾§æ–‡å­—
        Text(this.isBusy ? 'è¯†åˆ«ä¸­' : 'é€‰å›¾')
          .fontSize(14)
          .fontColor('#FFFFFF')
          .fontWeight(FontWeight.Bold)
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#34495E') // æ·±è‰²èƒŒæ™¯ï¼ŒæŠ¤çœ¼
      .borderRadius(25) // å…¨åœ†è§’
      .shadow({ radius: 8, color: 'rgba(0,0,0,0.4)', offsetY: 4 }) // æ‚¬æµ®é˜´å½±
      .justifyContent(FlexAlign.Center)
      .alignItems(VerticalAlign.Center)
      .onClick(async () => {
        if (this.isBusy) return;

        this.isBusy = true;
        // è°ƒç”¨ Manager é‡Œçš„æ–¹æ³•
        const count = await FloatingCapsuleManager.getInstance().triggerImageImport();
        this.isBusy = false;

        // å¯é€‰ï¼šè¿™é‡Œè™½ç„¶ä¸èƒ½å¼¹ Toastï¼Œä½†å¯ä»¥åœ¨æ§åˆ¶å°çœ‹ç»“æœ
        console.info(`æˆåŠŸå¯¼å…¥ ${count} ä¸ªå•è¯`);
      })
    }
    .width('100%')
    .height('100%')
  }
}